# [MANAGER]: Manager Deployment Configurations
controllerManager:
  replicas: 1
  container:
    image: quay.io/konflux-ci/integration-service:latest@sha256:6619323a65d1c686f13219406398f9c26a3c122fcf4edb83a4c2bdcb7b82ed06
    args:
      - "--metrics-bind-address=:8443"
      - "--leader-elect"
    ports:
      probes:
        - containerPort: 8081
          name: probes
          protocol: TCP
      webhook:
        - containerPort: 9443
          name: webhook-server
          protocol: TCP
    resources:
      limits:
        cpu: 500m
        memory: 128Mi
      requests:
        cpu: 10m
        memory: 64Mi
    livenessProbe:
      initialDelaySeconds: 15
      periodSeconds: 20
      httpGet:
        path: /healthz
        port: 8081
    readinessProbe:
      initialDelaySeconds: 5
      periodSeconds: 10
      httpGet:
        path: /readyz
        port: 8081
    securityContext:
      allowPrivilegeEscalation: false
      readOnlyRootFilesystem: true
  securityContext:
    runAsNonRoot: true
  terminationGracePeriodSeconds: 10
  serviceAccountName: integration-service-controller-manager

# [RBAC]: To enable RBAC (Permissions) configurations
rbac:
  enable: true

# [CRDs]: To enable the CRDs
crd:
  # This option determines whether the CRDs are included
  # in the installation process.
  enable: true

  # Enabling this option adds the "helm.sh/resource-policy": keep
  # annotation to the CRD, ensuring it remains installed even when
  # the Helm release is uninstalled.
  # NOTE: Removing the CRDs will also remove all cert-manager CR(s)
  # (Certificates, Issuers, ...) due to garbage collection.
  keep: true

# [METRICS]: Set to true to generate manifests for exporting metrics.
# To disable metrics export set false, and ensure that the
# ControllerManager argument "--metrics-bind-address=:8443" is removed.
metrics:
  enable: true

# [WEBHOOKS]: Webhooks configuration
# The following configuration is automatically generated from the manifests
# generated by controller-gen. To update run 'make manifests' and
# the edit command with the '--force' flag
webhook:
  enable: true

# [PROMETHEUS]: To enable a ServiceMonitor to export metrics to Prometheus set true
prometheus:
  enable: true

# [CERT-MANAGER]: To enable cert-manager injection to webhooks set true
certmanager:
  enable: false

# [NETWORK POLICIES]: To enable NetworkPolicies set true
networkPolicy:
  enable: false

# [SNAPSHOT GC]: Snapshot garbage collector configuration
snapshotgc:
  enable: true
  image: quay.io/konflux-ci/integration-service:latest@sha256:6619323a65d1c686f13219406398f9c26a3c122fcf4edb83a4c2bdcb7b82ed06
  args:
    - --zap-log-level=debug
    - --pr-snapshots-to-keep=70
    - --non-pr-snapshots-to-keep=500
  resources:
    requests:
      cpu: 1000m
      memory: 500Mi
    limits:
      cpu: 1000m
      memory: 500Mi
  securityContext:
    readOnlyRootFilesystem: true
    runAsNonRoot: true

namespace: integration-service
chartCreateNamespace: false
